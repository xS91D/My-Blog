<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>文章列表 | xS91D Blog</title>
    <link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/mdui/0.4.1/css/mdui.min.css">
    <style>.article-card-media img { height: 200px; object-fit: cover; }</style>
</head>
<body class="mdui-theme-primary-grey mdui-theme-accent-blue">
    <main class="right-panel" style="margin-left: 300px; padding: 40px;">
        <div class="mdui-card"><div class="mdui-card-primary"><div class="mdui-card-primary-title">文章列表</div></div></div>
        <div id="article-list-container" class="mdui-grid-list mdui-row-xs-1 mdui-row-sm-2 mdui-row-lg-3" style="margin-top: 20px;">
            <div class="mdui-preloader mdui-center"></div>
        </div>
    </main>
<script>
    const SANITY_PROJECT_ID = '2yz78wot';
    const SANITY_DATASET = 'production';
    const GROQ_QUERY = encodeURIComponent(`*[_type == "post"] | order(publishedAt desc) {"slug": slug.current, title, publishedAt, "imageUrl": mainImage.asset->url, "excerpt": pt::text(body[0])}`);
    const API_URL = `https://${SANITY_PROJECT_ID}.api.sanity.io/v2021-10-21/data/query/${SANITY_DATASET}?query=${GROQ_QUERY}`;
    const container = document.getElementById('article-list-container');

    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch(API_URL);
            const { result } = await response.json();
            container.innerHTML = '';
            result.forEach(post => {
                const shortExcerpt = post.excerpt ? post.excerpt.substring(0, 80) + '...' : '暫無摘要';
                container.innerHTML += `
                    <div class="mdui-col"><div class="mdui-card mdui-hoverable">
                        <div class="mdui-card-media article-card-media"><img src="${post.imageUrl || ''}"/></div>
                        <div class="mdui-card-primary"><div class="mdui-card-primary-title">${post.title}</div><div class="mdui-card-primary-subtitle">${new Date(post.publishedAt).toLocaleDateString()}</div></div>
                        <div class="mdui-card-content"><p>${shortExcerpt}</p></div>
                        <div class="mdui-card-actions"><a href="post.html?slug=${post.slug}" class="mdui-btn mdui-ripple">閱讀全文</a></div>
                    </div></div>`;
            });
        } catch (error) {
            container.innerHTML = '<p>讀取文章失敗，請檢查 CORS 設定。</p>';
        }
    });
</script>
</body>
</html>